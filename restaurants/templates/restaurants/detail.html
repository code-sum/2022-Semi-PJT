{% extends 'base.html' %}
{% block content %}
  <div class="row d-flex text-center justify-content-center">
    <!-- 식당 이미지 -->
    <div class="col-4">
      {% if restaurant.image %}
        <img src="{{ restaurant.image.url }}" class="card-img-top" alt="{{ restaurant.image }}">
      {% else %}
        <img src="https://archive.org/download/no-photo-available/no-photo-available.png" class="card-img-top" alt="none">
      {% endif %}
    </div>
    <h1>{{ restaurant.name }}</h1>
    <!-- 좋아요 버튼 / 좋아요 수 -->
    <div class="ms-3 d-flex align-items-center">
      {% if request.user.is_authenticated %}
        {% if request.user in restaurant.like_users.all %}
          <i id="like-btn" data-restaurant-id="{{ restaurant.pk }}" class="text-danger bi bi-heart-fill"></i>
        {% else %}
          <i id="like-btn" data-restaurant-id="{{ restaurant.pk }}" class="text-danger bi bi-heart"></i>
        {% endif %}
      {% endif %}
      <div class="ms-2" id="like-count">{{ restaurant.like_users.count }}</div>
    </div>
    <!-- 식당 정보수정 버튼, 식당 삭제 버튼(관리자한테만 보임) -->
    <div>
      {% if user.is_superuser %}
        <a href="{% url 'restaurants:update' restaurant.pk %}" class="btn btn-success">정보수정</a>
        <form action="{% url 'restaurants:delete' restaurant.pk %}" method="POST">
          {% csrf_token %}
          <input type="submit" value="식당삭제" class="btn btn-danger">
        </form>
      {% endif %}
    </div>
    <button>
      <a href="{% url 'reviews:create' restaurant.pk %}">리뷰작성</a>
    </button>
    {% for review in reviews %}
      <div class="card">
        <div class="card-body">
          <a href="{% url 'reviews:detail' review.pk %}">{{ review.content }}</a>
        </div>
      </div>
    {% endfor %}
  </div>
{% endblock content %}

{% block script %}
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    const likeBtn = document.querySelector('#like-btn')
    likeBtn.addEventListener('click', function (event) {
      console.log(event.target.dataset)
      axios({method: 'get', url: `/restaurants/${event.target.dataset.restaurantId}/like/`}).then(response => {
        if (response.data.is_liked === true) {
          event
            .target
            .classList
            .add('bi-heart-fill')
          event
            .target
            .classList
            .remove('bi-heart')
        } else {
          event
            .target
            .classList
            .add('bi-heart')
          event
            .target
            .classList
            .remove('bi-heart-fill')
        }
        const likeCount = document.querySelector('#like-count')
        likeCount.innerText = response.data.likeCount
      })
    })
  </script>
{% endblock script %}